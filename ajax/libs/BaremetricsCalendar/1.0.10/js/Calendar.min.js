"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["jquery","moment"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("moment")):t.Calendar=e(jQuery,moment)}(this,function(t,e){function a(a){var s=this;this.settings=a,this.calIsOpen=!1,this.presetIsOpen=!1,this.sameDayRange=a.same_day_range||!1,this.element=a.element||t(".daterange"),this.selected=null,this.type=this.element.hasClass("daterange--single")?"single":"double",this.required=0!=a.required,this.format=a.format||{},this.format.input=a.format&&a.format.input||"MMMM D, YYYY",this.format.preset=a.format&&a.format.preset||"ll",this.format.jump_month=a.format&&a.format.jump_month||"MMMM",this.format.jump_year=a.format&&a.format.jump_year||"YYYY",this.placeholder=a.placeholder||this.format.input,this.days_array=a.days_array&&7==a.days_array.length?a.days_array:e.weekdaysMin(),this.orig_start_date=null,this.orig_end_date=null,this.orig_current_date=null,this.earliest_date=e(a.earliest_date?a.earliest_date:"1900-01-01"),this.latest_date=e(a.latest_date?a.latest_date:"2900-12-31"),this.end_date=a.end_date?e(a.end_date):"double"==this.type?e():null,this.start_date=a.start_date?e(a.start_date):"double"==this.type?this.end_date.clone().subtract(1,"month"):null,this.current_date=a.current_date?e(a.current_date):"single"==this.type?e():null,this.presets=0!=a.presets&&"single"!=this.type,this.callback=a.callback||this.calendarSetDates,this.calendarHTML(this.type),t(".dr-presets",this.element).click(function(){s.presetToggle()}),t(".dr-list-item",this.element).click(function(){var e=t(".dr-item-aside",this).data("start"),a=t(".dr-item-aside",this).data("end");s.start_date=s.calendarCheckDate(e),s.end_date=s.calendarCheckDate(a),s.calendarSetDates(),s.presetToggle(),s.calendarSaveDates()}),t(".dr-date",this.element).on({click:function(){s.calendarOpen(this)},keyup:function(t){9!=t.keyCode||s.calIsOpen||s.start_date||s.end_date||s.calendarOpen(this)},keydown:function(a){switch(a.keyCode){case 9:t(s.selected).hasClass("dr-date-start")?(a.preventDefault(),s.calendarCheckDates(),s.calendarSetDates(),t(".dr-date-end",s.element).trigger("click")):(s.calendarCheckDates(),s.calendarSetDates(),s.calendarSaveDates(),s.calendarClose("force"));break;case 13:a.preventDefault(),s.calendarCheckDates(),s.calendarSetDates(),s.calendarSaveDates(),s.calendarClose("force");break;case 27:s.calendarSetDates(),s.calendarClose("force");break;case 38:a.preventDefault();var r="day";a.shiftKey&&(r="week"),a.metaKey&&(r="month");var d=e(s.current_date).subtract(1,r);t(this).html(d.format(s.format.input)),s.current_date=d;break;case 40:a.preventDefault();var r="day";a.shiftKey&&(r="week"),a.metaKey&&(r="month");var i=e(s.current_date).add(1,r);t(this).html(i.format(s.format.input)),s.current_date=i}}}),t(".dr-month-switcher i",this.element).click(function(){var a=t(".dr-month-switcher span",s.element).data("month"),r=t(".dr-year-switcher span",s.element).data("year"),d=e([r,a,1]),i=d.clone().subtract(1,"month"),n=d.clone().add(1,"month").startOf("day");t(this).hasClass("dr-left")?s.calendarOpen(s.selected,i):t(this).hasClass("dr-right")&&s.calendarOpen(s.selected,n)}),t(".dr-year-switcher i",this.element).click(function(){var a=t(".dr-month-switcher span",s.element).data("month"),r=t(".dr-year-switcher span",s.element).data("year"),d=e([r,a,1]),i=d.clone().subtract(1,"year"),n=d.clone().add(1,"year").startOf("day");t(this).hasClass("dr-left")?s.calendarOpen(s.selected,i):t(this).hasClass("dr-right")&&s.calendarOpen(s.selected,n)}),t(".dr-dates-dash",this.element).click(function(){t(".dr-date-start",s.element).trigger("click")}),this.element.on("click",function(){document.addEventListener("click",function(e){var a=s.element.find(e.path[0]);a.length||(s.presetIsOpen&&s.presetToggle(),s.calIsOpen&&(t(s.selected).hasClass("dr-date-end")&&s.calendarSaveDates(),s.calendarSetDates(),s.calendarClose("force")))})})}function s(a,s,r){var d=e(r).format(s.format.input);a&&t(".dr-date",s.element).not(s.selected).html(a.format(s.format.input)),t(s.selected).html(d),s.calendarOpen(s.selected),t(s.selected).hasClass("dr-date-start")?t(".dr-date-end",s.element).trigger("click"):(s.calendarSaveDates(),s.calendarClose("force"))}return a.prototype.presetToggle=function(){0==this.presetIsOpen?(this.orig_start_date=this.start_date,this.orig_end_date=this.end_date,this.orig_current_date=this.current_date,this.presetIsOpen=!0):this.presetIsOpen&&(this.presetIsOpen=!1),1==this.calIsOpen&&this.calendarClose(),t(".dr-preset-list",this.element).slideToggle(200),t(".dr-input",this.element).toggleClass("dr-active"),t(".dr-presets",this.element).toggleClass("dr-active"),this.element.toggleClass("dr-active")},a.prototype.presetCreate=function(){var a=this,s=t('<ul class="dr-preset-list" style="display: none;"></ul>'),r="object"==typeof a.settings.presets?a.settings.presets:[{label:"Last 30 days",start:e(a.latest_date).subtract(29,"days"),end:a.latest_date},{label:"Last month",start:e(a.latest_date).subtract(1,"month").startOf("month"),end:e(a.latest_date).subtract(1,"month").endOf("month")},{label:"Last 3 months",start:e(a.latest_date).subtract(3,"month").startOf("month"),end:e(a.latest_date).subtract(1,"month").endOf("month")},{label:"Last 6 months",start:e(a.latest_date).subtract(6,"month").startOf("month"),end:e(a.latest_date).subtract(1,"month").endOf("month")},{label:"Last year",start:e(a.latest_date).subtract(12,"month").startOf("month"),end:e(a.latest_date).subtract(1,"month").endOf("month")},{label:"All time",start:a.earliest_date,end:a.latest_date}];return e(a.latest_date).diff(e(a.latest_date).startOf("month"),"days")>=6&&"object"!=typeof a.settings.presets&&r.splice(1,0,{label:"This month",start:e(a.latest_date).startOf("month"),end:a.latest_date}),t.each(r,function(r,d){e(d.start).isBefore(a.earliest_date)&&(d.start=a.earliest_date),e(d.start).isAfter(a.latest_date)&&(d.start=a.latest_date),e(d.end).isBefore(a.earliest_date)&&(d.end=a.earliest_date),e(d.end).isAfter(a.latest_date)&&(d.end=a.latest_date);var i=e(d.start).toISOString(),n=e(d.end).toISOString(),l=e(d.start).format(a.format.preset)+" &ndash; "+e(d.end).format(a.format.preset);if(t(".dr-preset-list",a.element).length){var h=t(".dr-preset-list .dr-list-item:nth-of-type("+(r+1)+") .dr-item-aside",a.element);h.data("start",i),h.data("end",n),h.html(l)}else s.append('<li class="dr-list-item">'+d.label+'<span class="dr-item-aside" data-start="'+i+'" data-end="'+n+'">'+l+"</span></li>")}),s},a.prototype.calendarSetDates=function(){if(t(".dr-date-start",this.element).html(e(this.start_date).format(this.format.input)),t(".dr-date-end",this.element).html(e(this.end_date).format(this.format.input)),!this.start_date&&!this.end_date){var a=t(".dr-date",this.element).html(),s=e(this.current_date).format(this.format.input);0!==a.length||this.required||(s=""),a!=s&&t(".dr-date",this.element).html(s)}},a.prototype.calendarSaveDates=function(){if("double"===this.type){if(!e(this.orig_end_date).isSame(this.end_date)||!e(this.orig_start_date).isSame(this.start_date))return this.callback()}else if(!this.required||!e(this.orig_current_date).isSame(this.current_date))return this.callback()},a.prototype.calendarCheckDate=function(t){if("today"===t||"now"===t)return e().isAfter(this.latest_date)?this.latest_date:e().isBefore(this.earliest_date)?this.earliest_date:e();if("earliest"===t)return this.earliest_date;if("latest"===t)return this.latest_date;if(t&&(/\bago\b/.test(t)||/\bahead\b/.test(t)))return this.stringToDate(t);var a=/(?:\d)((?:st|nd|rd|th)?,?)/,s=t?t.replace(a,"").split(" "):[];2==s.length&&(s.push(e().format(this.format.jump_year)),t=s.join(" "));var r=this.parseDate(t);return r.isValid()?r:e(t)},a.prototype.calendarCheckDates=function(){var a,s,r=t(".dr-date-start",this.element).html(),d=t(".dr-date-end",this.element).html(),i=this.calendarCheckDate(t(this.selected).html());if("ytd"===r||"ytd"===d?(a=e().startOf("year"),s=e().endOf("year")):(a=this.calendarCheckDate(r),s=this.calendarCheckDate(d)),i.isBefore(this.earliest_date)&&(i=this.earliest_date),a.isBefore(this.earliest_date)&&(a=this.earliest_date),(s.isBefore(this.earliest_date)||s.isBefore(a))&&(s=a.clone().add(6,"day")),i.isAfter(this.latest_date)&&(i=this.latest_date),s.isAfter(this.latest_date)&&(s=this.latest_date),(a.isAfter(this.latest_date)||a.isAfter(s))&&(a=s.clone().subtract(6,"day")),"double"===this.type){if(a.isSame(s)&&!this.sameDayRange)return this.calendarSetDates();this.start_date=a.isValid()?a:this.start_date,this.end_date=s.isValid()?s:this.end_date}this.current_date=i.isValid()?i:this.current_date},a.prototype.stringToDate=function(t){var a=t.split(" ");return"ago"===a[2]?e(this.current_date).subtract(a[0],a[1]):"ahead"===a[2]?e(this.current_date).add(a[0],a[1]):this.current_date},a.prototype.calendarOpen=function(a,r){var d,i=this,n=t(".dr-dates",this.element).innerWidth()-8;this.selected=a||this.selected,1==this.presetIsOpen&&this.presetToggle(),1==this.calIsOpen?this.calendarClose(r?"switcher":void 0):t(this.selected).html().length&&(this.orig_start_date=this.start_date,this.orig_end_date=this.end_date,this.orig_current_date=this.current_date),this.calendarCheckDates(),this.calendarCreate(r),this.calendarSetDates();var l=e(r||this.current_date).add(1,"month").startOf("month").startOf("day"),h=e(r||this.current_date).subtract(1,"month").endOf("month"),c=e(r||this.current_date).add(1,"year").startOf("month").startOf("day"),o=e(r||this.current_date).subtract(1,"year").endOf("month"),m=e(r||this.current_date);t(".dr-month-switcher span",this.element).data("month",m.month()).html(m.format(this.format.jump_month)),t(".dr-year-switcher span",this.element).data("year",m.year()).html(m.format(this.format.jump_year)),t(".dr-switcher i",this.element).removeClass("dr-disabled"),l.isAfter(this.latest_date)&&t(".dr-month-switcher .dr-right",this.element).addClass("dr-disabled"),h.isBefore(this.earliest_date)&&t(".dr-month-switcher .dr-left",this.element).addClass("dr-disabled"),c.isAfter(this.latest_date)&&t(".dr-year-switcher .dr-right",this.element).addClass("dr-disabled"),o.isBefore(this.earliest_date)&&t(".dr-year-switcher .dr-left",this.element).addClass("dr-disabled"),t(".dr-day",this.element).on({mouseenter:function(){function a(a){d=void 0,i.range(42).forEach(function(r){var n=s.next().data("date"),l=s.prev().data("date"),h=s.data("date");if(!h)return!1;if(l||(l=h),n||(n=h),"start"==a){if(e(n).isSame(i.end_date)||i.sameDayRange&&e(h).isSame(i.end_date))return!1;if(e(h).isAfter(i.end_date)&&(d=d||e(h).add(6,"day").startOf("day"),r>5||!!n&&e(n).isAfter(i.latest_date)))return t(s).addClass("dr-end"),d=e(h),!1;s=s.next().addClass("dr-maybe")}else if("end"==a){if(e(l).isSame(i.start_date)||i.sameDayRange&&e(h).isSame(i.start_date))return!1;if(e(h).isBefore(i.start_date)&&(d=d||e(h).subtract(6,"day"),r>5||!!l&&e(l).isBefore(i.earliest_date)))return t(s).addClass("dr-start"),d=e(h),!1;s=s.prev().addClass("dr-maybe")}})}var s=t(this);e(i.start_date),e(i.end_date),e(i.current_date);t(i.selected).hasClass("dr-date-start")&&(s.addClass("dr-hover dr-hover-before"),t(".dr-start",i.element).css({border:"none","padding-left":"0.3125rem"}),a("start")),t(i.selected).hasClass("dr-date-end")&&(s.addClass("dr-hover dr-hover-after"),t(".dr-end",i.element).css({border:"none","padding-right":"0.3125rem"}),a("end")),i.start_date||i.end_date||s.addClass("dr-maybe"),t(".dr-selected",i.element).css("background-color","transparent")},mouseleave:function(){t(this).hasClass("dr-hover-before dr-end")&&t(this).removeClass("dr-end"),t(this).hasClass("dr-hover-after dr-start")&&t(this).removeClass("dr-start"),t(this).removeClass("dr-hover dr-hover-before dr-hover-after"),t(".dr-start, .dr-end",i.element).css({border:"",padding:""}),t(".dr-maybe:not(.dr-current)",i.element).removeClass("dr-start dr-end"),t(".dr-day",i.element).removeClass("dr-maybe"),t(".dr-selected",i.element).css("background-color","")}}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(t(".dr-day",this.element).on({touchstart:function(){s(d,i,t(this).data("date"))}}),t("div[contenteditable]",this.element).removeAttr("contenteditable")):t(".dr-day",this.element).on({mousedown:function(){s(d,i,t(this).data("date"))}}),t(".dr-calendar",this.element).css("width",n).slideDown(200),t(".dr-input",this.element).addClass("dr-active"),t(a).addClass("dr-active").focus(),this.element.addClass("dr-active"),this.calIsOpen=!0},a.prototype.calendarClose=function(e){var a=this;return!this.calIsOpen||this.presetIsOpen||"force"==e?t(".dr-calendar",this.element).slideUp(200,function(){t(".dr-day",a.element).remove()}):t(".dr-day",this.element).remove(),"switcher"!=e&&(t(".dr-input, .dr-date",this.element).removeClass("dr-active"),this.element.removeClass("dr-active"),void(this.calIsOpen=!1))},a.prototype.calendarCreate=function(e){var a=this,s=this.calendarArray(this.start_date,this.end_date,this.current_date,e);s.forEach(function(e,s){var r="dr-day";e.fade&&(r+=" dr-fade"),e.start&&(r+=" dr-start"),e.end&&(r+=" dr-end"),e.current&&(r+=" dr-current"),e.selected&&(r+=" dr-selected"),e.outside&&(r+=" dr-outside"),t(".dr-day-list",a.element).append('<li class="'+r+'" data-date="'+e.date+'">'+e.str+"</li>")})},a.prototype.calendarArray=function(t,a,s,r){var d=this;s=e(s||t||a).startOf("day");for(var i=r||s||t||a,n=e(i).startOf("month").startOf("week"),l=e(n).add(41,"days").endOf("day"),h=[],c=e(n);c.isBefore(l);)h.push({str:+c.format("D"),start:t&&c.isSame(t,"day"),end:a&&c.isSame(a,"day"),current:s&&c.isSame(s,"day"),selected:t&&a&&c.isBetween(t,a),date:c.toISOString(),outside:c.isBefore(d.earliest_date)||c.isAfter(d.latest_date),fade:!c.isSame(i,"month")}),c.add(1,"d");return h},a.prototype.calendarHTML=function(a){var s=t('<ul class="dr-days-of-week-list"></ul>'),r=this.days_array.splice(e.localeData().firstDayOfWeek()).concat(this.days_array.splice(0,e.localeData().firstDayOfWeek()));return t.each(r,function(t,e){s.append('<li class="dr-day-of-week">'+e+"</li>")}),"double"==a?this.element.append('<div class="dr-input"><div class="dr-dates"><div class="dr-date dr-date-start" contenteditable>'+e(this.start_date).format(this.format.input)+'</div><span class="dr-dates-dash">&ndash;</span><div class="dr-date dr-date-end" contenteditable>'+e(this.end_date).format(this.format.input)+"</div></div>"+(this.presets?'<div class="dr-presets"><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span></div>':"")+'</div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span>April</span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span>2015</span><i class="dr-right"></i></div></div>'+s[0].outerHTML+'<ul class="dr-day-list"></ul></div>'+(this.presets?this.presetCreate()[0].outerHTML:"")+"</div>"):this.element.append('<div class="dr-input"><div class="dr-dates"><div class="dr-date" contenteditable placeholder="'+this.placeholder+'">'+(this.settings.current_date?e(this.current_date).format(this.format.input):"")+'</div></div></div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div></div>'+s[0].outerHTML+'<ul class="dr-day-list"></ul></div></div>')},a.prototype.parseDate=function(t){return null!==e.defaultZone&&e.hasOwnProperty("tz")?e.tz(t,this.format.input,e.defaultZone.name):e(t,this.format.input)},a.prototype.range=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=a;return e},a});
//# sourceMappingURL=Calendar.min.js.map